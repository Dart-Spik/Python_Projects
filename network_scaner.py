import scapy.all as scapy
import socket 
import threading
from queue import Queue
import ipaddress

def scan(ip, result_queue):
    arp_request = scapy.ARP(pdst=ip)
    broadcast = scapy.Ether(dst="ff:ff:ff:ff:ff:ff")
    packet = broadcast/arp_request
    answer = scapy.srp(packet, timeout=1, verbose=False)[0]

    clients = []
    for client in answer:
        client_info = {'IP': client[1].psrc, 'MAC': client[1].hwsrc}
        try:
            hostname = socket.gethostbyaddr(client_info['IP'])[0]
            client_info['Hostname'] = hostname
        except socket.herror:
            client_info['Hostname'] = 'Unknown'
        clients.append(client_info)
    result_queue.put(clients)

def print_result(result):
    print('IP' + " "*20 + 'MAC' + " "*20 + 'Hostname')
    print('-'*80)
    for client in result:
        print(client['IP'] + '\t\t' + client['MAC'] + '\t\t' + client['Hostname'])

def main(cidr):
    results_queue = Queue()
    threads = []
    network = ipaddress.ip_network(cidr, strict=False)

    for ip in network.hosts():
        thread = threading.Thread(target=scan, args=(str(ip), results_queue))
        thread.start()
        threads.append(thread)
    
    for thread in threads:
        thread.join()
    
    all_clients = []
    while not results_queue.empty():
        all_clients.extend(results_queue.get())
    
    print_result(all_clients)

if __name__ == '__main__':
    cidr = input("Enter network ip address: ")
    main(cidr){"threads":[{"position":0,"start":0,"end":763,"connection":"open"},{"position":1525,"start":764,"end":1525,"connection":"closed"}],"url":"https://att-c.udemycdn.com/2024-07-26_21-31-52-104b1c9825f70a30e801ad168e90fc74/original.py?response-content-disposition=attachment%3B+filename%3Dnetwork_scaner.py&Expires=1722423302&Signature=aQ5OMUVw2lDOEtC6f0Dul0bGr7jeHwxR8qKDiJuoeSSlRJb5jbzI~Xds9veK6J-ku6cG1GVQbm2mV-KZJ~aw83ptxvi1~z5OWQG4hVEHszAsiRIMw5WzYFQUoCA1UUNQiNq26~M4tVZ7m32KBt2H-po5FVqIrLB3Sljn6nKDianzsuLwmZDfZFFtwZdwItI9kWzj1FojScmEavfHjl9MVaaKEhc-XeD3hvucMqH6~T7JwHnLbgnprK1O3z1W5efTFILy8s3wr~WiJoxdiu2q9YgFO4WgEcXaDM2uZL4-H3HZsBpqzoGBHSMypljKi4A~1V6bdjECzeYTRQ-Xt~UlGg__&Key-Pair-Id=K3MG148K9RIRF4","method":"GET","port":443,"downloadSize":1525,"headers":{"content-type":"text/x-python","content-length":"1525","connection":"close","date":"Wed, 31 Jul 2024 06:26:09 GMT","x-amz-replication-status":"COMPLETED","last-modified":"Fri, 26 Jul 2024 21:31:53 GMT","etag":"\"738bfc10f0e1a8ba55eb125e37839c14\"","x-amz-server-side-encryption":"AES256","x-amz-meta-qqfilename":"network_scaner.py","x-amz-version-id":"0qBTBgTed8CuuM7h3sm4h7r4KifMrkWR","content-disposition":"attachment; filename=network_scaner.py","accept-ranges":"bytes","server":"AmazonS3","x-cache":"Miss from cloudfront","via":"1.1 7ce9bf658969fea1ceecfa00e5239dd6.cloudfront.net (CloudFront)","x-amz-cf-pop":"AMS58-P6","x-amz-cf-id":"3LK5C-sXmJQichFqq1Q9kT4SbQw775jK23PcWUyZx8srDG7ufod7JQ==","x-cdn":"cf-cloudfront","vary":"Origin"}}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    